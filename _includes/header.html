<header>

  <!-- Nav Bar -->
  <nav id="navbar" class="navbar navbar-light navbar-expand-sm {% if site.navbar_fixed %}fixed-top{% else %}sticky-top{% endif %}">
    <div class="container">

      {% comment %}
      ================================
      Bilingual Support (Scheme B)
      ================================
      curr_lang:
        - zh (default)
        - en
      未写 lang 的页面默认归为 zh
      ================================
      {% endcomment %}

      {% assign curr_lang = page.lang | default: "zh" %}
      {% assign about_title = "Home" %}

      {%- for p in site.pages -%}
        {% assign p_lang = p.lang | default: "zh" %}
        {% if curr_lang == "zh" and p.permalink == "/" and p_lang == "zh" %}
          {% assign about_title = p.title %}
        {% endif %}
        {% if curr_lang == "en" and p.permalink == "/en/" and p_lang == "en" %}
          {% assign about_title = p.title %}
        {% endif %}
      {%- endfor -%}

      <!-- Brand -->
      <a class="navbar-brand title font-weight-lighter"
         href="{% if curr_lang == 'en' %}{{ '/en/' | relative_url }}{% else %}{{ '/' | relative_url }}{% endif %}">
        {%- if site.title == "blank" -%}
          {{ site.first_name }} {{ site.last_name }}
        {%- else -%}
          {{ site.title }}
        {%- endif -%}
      </a>

      <!-- Navbar Toggle -->
      <button class="navbar-toggler collapsed ml-auto" type="button"
              data-toggle="collapse" data-target="#navbarNav">
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>

      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">

          <!-- Home -->
          <li class="nav-item {% if page.permalink == '/' or page.permalink == '/en/' %}active{% endif %}">
            <a class="nav-link"
               href="{% if curr_lang == 'en' %}{{ '/en/' | relative_url }}{% else %}{{ '/' | relative_url }}{% endif %}">
              {{ about_title }}
            </a>
          </li>

          {% if site.blog_nav_title %}
          <!-- Blog -->
          <li class="nav-item {% if page.url contains 'blog' %}active{% endif %}">
            <a class="nav-link"
               href="{% if curr_lang == 'en' %}{{ '/en/blog/' | relative_url }}{% else %}{{ '/blog/' | relative_url }}{% endif %}">
              {{ site.blog_nav_title }}
            </a>
          </li>
          {% endif %}

          <!-- Other pages -->
          {% assign sorted_pages = site.pages | sort: "nav_order" %}
          {% for p in sorted_pages %}
            {% assign p_lang = p.lang | default: "zh" %}
            {% if p.nav and p.autogen == nil and p_lang == curr_lang %}
              {% unless p.permalink == "/" or p.permalink == "/en/" %}
                <li class="nav-item {% if page.title == p.title %}active{% endif %}">
                  <a class="nav-link" href="{{ p.url | relative_url }}">
                    {{ p.title }}
                  </a>
                </li>
              {% endunless %}
            {% endif %}
          {% endfor %}

          <!-- Language Switch -->
          <li class="nav-item">
            {% include lang_switch.html %}
          </li>

          {% if site.enable_darkmode %}
          <!-- Dark Mode -->
          <li class="toggle-container">
            <button id="light-toggle" title="Change theme">
              <i class="fas fa-moon"></i>
              <i class="fas fa-sun"></i>
            </button>
          </li>
          {% endif %}

        </ul>
      </div>
    </div>
  </nav>

  {% if site.enable_progressbar %}
  <progress id="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
  {% endif %}

</header>
